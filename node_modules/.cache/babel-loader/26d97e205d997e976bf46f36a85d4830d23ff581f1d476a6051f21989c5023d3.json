{"ast":null,"code":"import { ref, computed } from 'vue';\nimport axios from 'axios';\nimport { jsPDF } from 'jspdf';\nconst API_URL = 'http://localhost:3000/api';\nexport default {\n  __name: 'QuizComponent',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const questions = ref([]);\n    const currentQuestionIndex = ref(0);\n    const answers = ref({});\n    const userEmail = ref('');\n    const emailError = ref(false);\n    const isLoading = ref(true);\n\n    // Fetch questions from DB\n    const loadQuestions = async () => {\n      try {\n        const response = await axios.get(`${API_URL}/questions`);\n        questions.value = response.data;\n        isLoading.value = false;\n      } catch (error) {\n        console.error('Error loading questions:', error);\n        isLoading.value = false;\n      }\n    };\n    const currentQuestion = computed(() => questions.value[currentQuestionIndex.value]);\n    const isCompleted = computed(() => currentQuestionIndex.value >= questions.value.length);\n    const progress = computed(() => currentQuestionIndex.value / questions.value.length * 100);\n    const isValidEmail = computed(() => {\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      return emailRegex.test(userEmail.value);\n    });\n    const answerQuestion = answer => {\n      if (currentQuestion.value) {\n        answers.value[currentQuestion.value._id] = answer;\n        currentQuestionIndex.value++;\n      }\n    };\n    const generatePDF = async () => {\n      const doc = new jsPDF({\n        unit: 'mm',\n        format: 'a4',\n        compress: true\n      });\n\n      // Header\n      doc.setFontSize(22);\n      doc.text('Raport de Evaluare', 105, 25, {\n        align: 'center'\n      });\n\n      // Data\n      doc.setFontSize(12);\n      const date = new Date().toLocaleDateString('ro-RO', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit'\n      }).split('.').join('.');\n      doc.text(`Generat la: ${date}`, 105, 35, {\n        align: 'center'\n      });\n      let yPos = 50;\n\n      // Parcurgere întrebări și răspunsuri\n      for (const question of questions.value) {\n        const userAnswer = answers.value[question._id];\n\n        // Verifică spațiul disponibil\n        if (yPos > 250) {\n          doc.addPage();\n          yPos = 30;\n        }\n\n        // Întrebarea\n        doc.setFontSize(12);\n        doc.setFont(\"helvetica\", \"normal\");\n        doc.text(`${question.text}`, 20, yPos);\n        yPos += 10;\n\n        // Răspuns\n        doc.setFontSize(12);\n        doc.text(`Răspuns: ${userAnswer ? 'Da' : 'Nu'}`, 20, yPos, {\n          charSpace: 0\n        });\n        yPos += 8;\n\n        // Feedback\n        const feedback = userAnswer ? question.feedbackYes : question.feedbackNo;\n        const splitFeedback = doc.splitTextToSize(feedback, 170);\n        doc.setFontSize(12);\n        splitFeedback.forEach(line => {\n          if (yPos > 270) {\n            doc.addPage();\n            yPos = 30;\n          }\n          doc.text(line, 20, yPos, {\n            charSpace: 0\n          });\n          yPos += 7;\n        });\n        yPos += 10;\n      }\n\n      // Footer\n      doc.setFontSize(10);\n      doc.text('Document generat automat', 105, 280, {\n        align: 'center',\n        charSpace: 0\n      });\n      return doc.output('blob');\n    };\n    const submitResults = async () => {\n      if (!isValidEmail.value) {\n        emailError.value = true;\n        return;\n      }\n      try {\n        const pdfBlob = await generatePDF();\n        const formData = new FormData();\n        formData.append('pdf', pdfBlob, 'rezultate.pdf');\n        formData.append('email', userEmail.value);\n        await axios.post(`${API_URL}/send-results`, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        alert('Rezultatele au fost trimise pe email!');\n      } catch (error) {\n        console.error('Error:', error);\n        alert('A apărut o eroare. Te rugăm să încerci din nou.');\n      }\n    };\n\n    // Load questions when component is mounted\n    loadQuestions();\n    const __returned__ = {\n      API_URL,\n      questions,\n      currentQuestionIndex,\n      answers,\n      userEmail,\n      emailError,\n      isLoading,\n      loadQuestions,\n      currentQuestion,\n      isCompleted,\n      progress,\n      isValidEmail,\n      answerQuestion,\n      generatePDF,\n      submitResults,\n      ref,\n      computed,\n      get axios() {\n        return axios;\n      },\n      get jsPDF() {\n        return jsPDF;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","axios","jsPDF","API_URL","questions","currentQuestionIndex","answers","userEmail","emailError","isLoading","loadQuestions","response","get","value","data","error","console","currentQuestion","isCompleted","length","progress","isValidEmail","emailRegex","test","answerQuestion","answer","_id","generatePDF","doc","unit","format","compress","setFontSize","text","align","date","Date","toLocaleDateString","year","month","day","split","join","yPos","question","userAnswer","addPage","setFont","charSpace","feedback","feedbackYes","feedbackNo","splitFeedback","splitTextToSize","forEach","line","output","submitResults","pdfBlob","formData","FormData","append","post","headers","alert"],"sources":["D:/Projects/Barmayoun/vue-questions/quizz-app-v2/src/components/QuizComponent.vue"],"sourcesContent":["<script setup>\r\nimport { ref, computed } from 'vue'\r\nimport axios from 'axios'\r\nimport { jsPDF } from 'jspdf'\r\n\r\nconst API_URL = 'http://localhost:3000/api'\r\n\r\nconst questions = ref([])\r\nconst currentQuestionIndex = ref(0)\r\nconst answers = ref({})\r\nconst userEmail = ref('')\r\nconst emailError = ref(false)\r\nconst isLoading = ref(true)\r\n\r\n// Fetch questions from DB\r\nconst loadQuestions = async () => {\r\n  try {\r\n    const response = await axios.get(`${API_URL}/questions`)\r\n    questions.value = response.data\r\n    isLoading.value = false\r\n  } catch (error) {\r\n    console.error('Error loading questions:', error)\r\n    isLoading.value = false\r\n  }\r\n}\r\n\r\nconst currentQuestion = computed(() =>\r\n  questions.value[currentQuestionIndex.value]\r\n)\r\n\r\nconst isCompleted = computed(() =>\r\n  currentQuestionIndex.value >= questions.value.length\r\n)\r\n\r\nconst progress = computed(() =>\r\n  (currentQuestionIndex.value / questions.value.length) * 100\r\n)\r\n\r\nconst isValidEmail = computed(() => {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\r\n  return emailRegex.test(userEmail.value)\r\n})\r\n\r\nconst answerQuestion = (answer) => {\r\n  if (currentQuestion.value) {\r\n    answers.value[currentQuestion.value._id] = answer\r\n    currentQuestionIndex.value++\r\n  }\r\n}\r\n\r\nconst generatePDF = async () => {\r\n  const doc = new jsPDF({\r\n    unit: 'mm',\r\n    format: 'a4',\r\n    compress: true\r\n  })\r\n\r\n  // Header\r\n  doc.setFontSize(22)\r\n  doc.text('Raport de Evaluare', 105, 25, { align: 'center' })\r\n\r\n  // Data\r\n  doc.setFontSize(12)\r\n  const date = new Date().toLocaleDateString('ro-RO', {\r\n    year: 'numeric',\r\n    month: '2-digit',\r\n    day: '2-digit'\r\n  }).split('.').join('.')\r\n  doc.text(`Generat la: ${date}`, 105, 35, { align: 'center' })\r\n\r\n  let yPos = 50\r\n\r\n  // Parcurgere întrebări și răspunsuri\r\n  for (const question of questions.value) {\r\n    const userAnswer = answers.value[question._id]\r\n\r\n    // Verifică spațiul disponibil\r\n    if (yPos > 250) {\r\n      doc.addPage()\r\n      yPos = 30\r\n    }\r\n\r\n    // Întrebarea\r\n    doc.setFontSize(12)\r\n    doc.setFont(\"helvetica\", \"normal\")\r\n    doc.text(`${question.text}`, 20, yPos)\r\n    yPos += 10\r\n\r\n    // Răspuns\r\n    doc.setFontSize(12)\r\n    doc.text(`Răspuns: ${userAnswer ? 'Da' : 'Nu'}`, 20, yPos, {\r\n      charSpace: 0\r\n    })\r\n    yPos += 8\r\n\r\n    // Feedback\r\n    const feedback = userAnswer ? question.feedbackYes : question.feedbackNo\r\n    const splitFeedback = doc.splitTextToSize(feedback, 170)\r\n\r\n    doc.setFontSize(12)\r\n    splitFeedback.forEach(line => {\r\n      if (yPos > 270) {\r\n        doc.addPage()\r\n        yPos = 30\r\n      }\r\n      doc.text(line, 20, yPos, {\r\n        charSpace: 0\r\n      })\r\n      yPos += 7\r\n    })\r\n\r\n    yPos += 10\r\n  }\r\n\r\n  // Footer\r\n  doc.setFontSize(10)\r\n  doc.text('Document generat automat', 105, 280, {\r\n    align: 'center',\r\n    charSpace: 0\r\n  })\r\n\r\n  return doc.output('blob')\r\n}\r\n\r\nconst submitResults = async () => {\r\n  if (!isValidEmail.value) {\r\n    emailError.value = true\r\n    return\r\n  }\r\n\r\n  try {\r\n    const pdfBlob = await generatePDF()\r\n    const formData = new FormData()\r\n    formData.append('pdf', pdfBlob, 'rezultate.pdf')\r\n    formData.append('email', userEmail.value)\r\n\r\n    await axios.post(`${API_URL}/send-results`, formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    })\r\n\r\n    alert('Rezultatele au fost trimise pe email!')\r\n  } catch (error) {\r\n    console.error('Error:', error)\r\n    alert('A apărut o eroare. Te rugăm să încerci din nou.')\r\n  }\r\n}\r\n\r\n// Load questions when component is mounted\r\nloadQuestions()\r\n</script>\r\n\r\n<template>\r\n  <div class=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-12 px-4\">\r\n    <div class=\"max-w-2xl mx-auto\">\r\n      <!-- Loading state -->\r\n      <div v-if=\"isLoading\" class=\"text-center py-12\">\r\n        <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\r\n        <p class=\"mt-4 text-gray-600\">Se încarcă întrebările...</p>\r\n      </div>\r\n\r\n      <!-- Quiz content -->\r\n      <div v-else-if=\"!isCompleted && questions.length > 0\"\r\n        class=\"bg-white/70 backdrop-blur-lg rounded-2xl p-8 shadow-lg border border-gray-100\">\r\n        <div class=\"space-y-6\">\r\n          <!-- Progress -->\r\n          <div class=\"flex items-center justify-between mb-6\">\r\n            <span class=\"text-sm font-medium text-gray-500\">\r\n              Progres\r\n            </span>\r\n            <span class=\"text-sm font-medium text-gray-500\">\r\n              {{ currentQuestionIndex + 1 }}/{{ questions.length }}\r\n            </span>\r\n          </div>\r\n\r\n          <div class=\"w-full bg-gray-200 rounded-full h-2 mb-8\">\r\n            <div class=\"bg-primary h-2 rounded-full transition-all duration-300\" :style=\"{ width: `${progress}%` }\">\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Question -->\r\n          <h2 class=\"text-2xl font-medium text-gray-800 mb-8\">\r\n            {{ currentQuestion.text }}\r\n          </h2>\r\n\r\n          <!-- Answer buttons -->\r\n          <div class=\"flex gap-4 justify-center\">\r\n            <button @click=\"answerQuestion(true)\"\r\n              class=\"flex-1 py-3 px-6 bg-primary hover:bg-primary/90 text-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all duration-200\">\r\n              Da\r\n            </button>\r\n            <button @click=\"answerQuestion(false)\"\r\n              class=\"flex-1 py-3 px-6 bg-white hover:bg-gray-50 text-gray-800 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200\">\r\n              Nu\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- No questions state -->\r\n      <div v-else-if=\"!isLoading && questions.length === 0\" class=\"text-center py-12\">\r\n        <p class=\"text-gray-600\">Nu există întrebări disponibile momentan.</p>\r\n      </div>\r\n\r\n      <!-- Completion state -->\r\n      <div v-else class=\"bg-white/70 backdrop-blur-lg rounded-2xl p-8 shadow-lg border border-gray-100\">\r\n        <div class=\"text-center space-y-6\">\r\n          <div class=\"mb-8\">\r\n            <div class=\"inline-flex items-center justify-center w-16 h-16 bg-primary/20 rounded-full mb-4\">\r\n              <svg class=\"w-8 h-8 text-primary\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\r\n              </svg>\r\n            </div>\r\n            <h2 class=\"text-2xl font-semibold text-gray-800 mb-2\">\r\n              Felicitări! Ai finalizat evaluarea\r\n            </h2>\r\n            <p class=\"text-gray-600\">\r\n              Introdu adresa ta de email pentru a primi raportul personalizat.\r\n            </p>\r\n          </div>\r\n\r\n          <div class=\"max-w-md mx-auto\">\r\n            <input type=\"email\" v-model=\"userEmail\" placeholder=\"email@example.com\"\r\n              class=\"w-full px-4 py-3 rounded-xl border border-gray-200 mb-4 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none\"\r\n              :class=\"{ 'border-red-300': emailError }\">\r\n            <button @click=\"submitResults\"\r\n              class=\"w-full py-3 px-6 bg-primary hover:bg-primary/90 text-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-50\"\r\n              :disabled=\"!isValidEmail\">\r\n              Trimite Rezultatele\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}